<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vairal-Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #F8FAFC; max-width: 500px; margin: 0 auto; box-shadow: 0 0 50px rgba(0,0,0,0.1); min-height: 100vh; overflow-x: hidden; }
        .app-header { background: white; position: sticky; top: 0; z-index: 100; padding: 15px 20px; border-bottom: 1px solid #f1f5f9; }
        .nav-btn.active { background: #10B981; color: white; box-shadow: 0 4px 12px rgba(16,185,129,0.3); }
        .banner-wrapper { width: 92%; margin: 15px auto; padding-top: 50%; position: relative; overflow: hidden; border-radius: 24px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); }
        #slider { display: flex; position: absolute; top: 0; left: 0; height: 100%; width: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .slide-container { min-width: 100%; height: 100%; }
        .banner-img { width: 100%; height: 100%; object-fit: cover; }
        .quick-links-scroll { display: flex; overflow-x: auto; gap: 15px; padding: 10px 20px; scrollbar-width: none; }
        .quick-links-scroll::-webkit-scrollbar { display: none; }
        .cat-item { flex: 0 0 auto; text-align: center; width: 65px; }
        .cat-img-wrap { width: 55px; height: 55px; border-radius: 50%; padding: 2px; background: linear-gradient(45deg, #10B981, #3B82F6); margin: 0 auto; }
        .cat-img-wrap img { width: 100%; height: 100%; border-radius: 50%; border: 2px solid white; object-fit: cover; }
        .video-card { background: white; border-radius: 24px; overflow: hidden; margin-bottom: 20px; border: 1px solid #f1f5f9; box-shadow: 0 4px 10px rgba(0,0,0,0.02); }
        #socialPopup { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.9); z-index: 10000; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(8px); }
        .popup-content { background: white; width: 100%; max-width: 320px; border-radius: 35px; padding: 30px; text-align: center; transform: scale(0.9); animation: pop 0.3s forwards; }
        @keyframes pop { to { transform: scale(1); } }
        .channel-list-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 10px; }
        .channel-circle-card { text-align: center; cursor: pointer; }
        .channel-circle-img { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #10B981; padding: 3px; margin: 0 auto; object-fit: cover; }
    </style>
</head>
<body class="pb-20">

    <div id="socialPopup">
        <div class="popup-content">
            <div class="w-16 h-16 bg-green-500 text-white rounded-full flex items-center justify-center mx-auto mb-4 text-2xl"><i class="fas fa-bell"></i></div>
            <h2 class="text-xl font-black text-slate-800">Officeal Updated!</h2>
            <p class="text-slate-400 text-[11px] font-bold mt-2 mb-6 uppercase tracking-wider">Join our official Channelüì•</p>
            <div class="space-y-3">
                <button onclick="openLink('fb')" class="w-full bg-[#1877F2] text-white py-4 rounded-2xl font-black text-xs uppercase shadow-lg">Facebook Follow</button>
                <button onclick="openLink('ig')" class="w-full bg-gradient-to-r from-purple-600 to-pink-500 text-white py-4 rounded-2xl font-black text-xs uppercase shadow-lg">Instagram Follow</button>
            </div>
            <button onclick="closePopup()" class="mt-5 text-slate-400 text-[10px] font-black uppercase tracking-widest"> Skip Join ‚ùå</button>
        </div>
    </div>

    <div class="app-header">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-xl font-black italic text-slate-900 tracking-tighter">VAIRAL-HUB</h1>
            <div class="flex gap-2">
                <div onclick="openLink('fb')" class="w-9 h-9 flex items-center justify-center bg-blue-50 text-blue-600 rounded-full cursor-pointer"><i class="fab fa-facebook-f text-sm"></i></div>
                <div onclick="openLink('ig')" class="w-9 h-9 flex items-center justify-center bg-pink-50 text-pink-600 rounded-full cursor-pointer"><i class="fab fa-instagram text-sm"></i></div>
            </div>
        </div>
        <div class="flex gap-2 mb-4">
            <button onclick="switchTab('public')" id="btnPublic" class="nav-btn active flex-1 py-3.5 rounded-2xl text-[11px] font-black uppercase transition-all">Public Post</button>
            <button onclick="switchTab('channel')" id="btnChannel" class="nav-btn flex-1 bg-slate-100 text-slate-400 py-3.5 rounded-2xl text-[11px] font-black uppercase transition-all">Channels</button>
        </div>
        <div class="relative">
            <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-xs"></i>
            <input type="text" id="searchInput" onkeyup="searchProduct()" placeholder="Search viral content..." class="w-full p-3.5 pl-10 rounded-2xl text-xs outline-none bg-slate-100 border-none">
        </div>
    </div>

    <div id="sectionPublic">
        <div id="catList" class="quick-links-scroll mt-4"></div>
        <div class="banner-wrapper"><div id="slider"></div></div>
        <div class="px-5 mt-6 mb-3 flex justify-between items-center">
            <h2 class="font-black text-slate-800 text-[12px] uppercase tracking-tighter">Top Trending Posts</h2>
            <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
        </div>
        <div id="videoSection" class="px-5"></div>
    </div>

    <div id="sectionChannel" class="hidden px-5 py-6">
        <div id="channelListDisplay" class="channel-list-grid"></div>
        <div id="channelPostsDisplay" class="hidden space-y-5">
            <button onclick="backToChannels()" class="mb-4 text-green-600 font-bold text-xs uppercase flex items-center">
                <i class="fas fa-arrow-left mr-2"></i> Back to Channels
            </button>
            <div id="channelPostsContainer"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAqKyGeugcyF0NKJCnfSG9imL5DwmBC1rw",
            authDomain: "v-to-v-seller.firebaseapp.com",
            databaseURL: "https://v-to-v-seller-default-rtdb.firebaseio.com",
            projectId: "v-to-v-seller",
            storageBucket: "v-to-v-seller.firebasestorage.app",
            messagingSenderId: "112227619126",
            appId: "1:112227619126:web:32c81be2f71f880887e397"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let socialLinks = { fb: "#", ig: "#" };
        let allChannelPosts = [];

        // NEW: Click Tracker Function
        function handleWatchClick(postId, videoUrl) {
            // Firebase mein click count badhane ke liye
            db.ref('settings/posts/' + postId + '/clicks').transaction((currentClicks) => {
                return (currentClicks || 0) + 1;
            });
            window.open(videoUrl, '_blank');
        }

        function openLink(type) { window.open(socialLinks[type], '_blank'); }

        function switchTab(tab) {
            const p = document.getElementById('sectionPublic');
            const c = document.getElementById('sectionChannel');
            const bP = document.getElementById('btnPublic');
            const bC = document.getElementById('btnChannel');
            if(tab === 'public') {
                p.classList.remove('hidden'); c.classList.add('hidden');
                bP.className = "nav-btn active flex-1 py-3.5 rounded-2xl text-[11px] font-black uppercase";
                bC.className = "nav-btn flex-1 bg-slate-100 text-slate-400 py-3.5 rounded-2xl text-[11px] font-black uppercase";
            } else {
                p.classList.add('hidden'); c.classList.remove('hidden');
                bC.className = "nav-btn active flex-1 py-3.5 rounded-2xl text-[11px] font-black uppercase";
                bP.className = "nav-btn flex-1 bg-slate-100 text-slate-400 py-3.5 rounded-2xl text-[11px] font-black uppercase";
                backToChannels(); 
            }
        }

        function showChannelPosts(channelName) {
            const list = document.getElementById('channelListDisplay');
            const postsArea = document.getElementById('channelPostsDisplay');
            const container = document.getElementById('channelPostsContainer');
            list.classList.add('hidden');
            postsArea.classList.remove('hidden');
            const filtered = allChannelPosts.filter(p => p.name === channelName);
            container.innerHTML = filtered.map(c => `
                <div class="bg-white p-5 rounded-[2.5rem] border border-slate-100 shadow-sm mb-4">
                    <div class="flex items-center gap-3 mb-4">
                        <img src="${c.logo}" class="w-11 h-11 rounded-full object-cover ring-2 ring-slate-50">
                        <div>
                            <p class="text-[12px] font-black uppercase text-slate-900">${c.name}</p>
                            <p class="text-[9px] text-green-500 font-bold uppercase">Verified Post</p>
                        </div>
                    </div>
                    <img src="${c.postImg}" onclick="window.open('${c.postLink}', '_blank')" class="w-full h-44 object-cover rounded-3xl cursor-pointer">
                    <p class="mt-3 text-[11px] font-bold text-slate-600">${c.postTitle}</p>
                    <button onclick="window.open('${c.postLink}', '_blank')" class="w-full mt-3 bg-green-600 text-white py-3 rounded-2xl text-[10px] font-black uppercase">Watch Now</button>
                </div>`).join('');
        }

        function backToChannels() {
            document.getElementById('channelListDisplay').classList.remove('hidden');
            document.getElementById('channelPostsDisplay').classList.add('hidden');
        }

        db.ref('settings').on('value', snap => {
            const s = snap.val(); if(!s) return;
            socialLinks.fb = s.facebook || "#";
            socialLinks.ig = s.instagram || "#";

            if(s.quickLinks) {
                document.getElementById('catList').innerHTML = Object.values(s.quickLinks).map(q => `
                    <div class="cat-item" onclick="window.open('${q.link}', '_blank')">
                        <div class="cat-img-wrap"><img src="${q.img}"></div>
                        <p class="text-[9px] font-bold mt-2 uppercase text-slate-600 truncate">${q.title}</p>
                    </div>`).join('');
            }

            if(s.banners) {
                const bArr = Object.values(s.banners);
                document.getElementById('slider').innerHTML = bArr.map(b => `<div class="slide-container"><img src="${b.img}" class="banner-img"></div>`).join('');
                startSlideShow(bArr.length);
            }

            // MODIFIED: Sort Public Posts by Clicks
            if(s.posts) {
                let postsArray = [];
                Object.keys(s.posts).forEach(key => {
                    postsArray.push({ id: key, ...s.posts[key] });
                });

                // Sorting Logic: Descending Order of Clicks
                postsArray.sort((a, b) => (b.clicks || 0) - (a.clicks || 0));

                let vHtml = "";
                postsArray.forEach(v => {
                    if(!v.hidden) vHtml += `
                    <div class="video-card">
                        <div class="relative" onclick="handleWatchClick('${v.id}', '${v.videoLink}')">
                            <img src="${v.img}" class="w-full h-52 object-cover">
                            <div class="absolute inset-0 bg-black/10 flex items-center justify-center">
                                <i class="fas fa-play-circle text-white text-5xl opacity-80"></i>
                            </div>
                            ${postsArray[0].id === v.id && (v.clicks > 0) ? '<span class="absolute top-4 left-4 bg-red-600 text-white text-[9px] font-black px-3 py-1 rounded-full shadow-lg uppercase tracking-tighter animate-bounce">Trending #1</span>' : ''}
                        </div>
                        <div class="p-4 flex justify-between items-center">
                            <div class="w-2/3">
                                <h3 class="font-bold text-[13px] text-slate-800 truncate">${v.title}</h3>
                                <p class="text-[9px] text-slate-400 font-bold uppercase mt-1"><i class="fas fa-eye mr-1"></i> ${v.clicks || 0} clicks</p>
                            </div>
                            <button onclick="handleWatchClick('${v.id}', '${v.videoLink}')" class="bg-green-600 text-white px-5 py-2.5 rounded-xl text-[10px] font-black">WATCH</button>
                        </div>
                    </div>`;
                });
                document.getElementById('videoSection').innerHTML = vHtml;
            }

            if(s.channels) {
                allChannelPosts = Object.values(s.channels);
                const uniqueChannels = [...new Set(allChannelPosts.map(item => item.name))];
                document.getElementById('channelListDisplay').innerHTML = uniqueChannels.map(name => {
                    const chan = allChannelPosts.find(c => c.name === name);
                    return `
                    <div class="channel-circle-card" onclick="showChannelPosts('${name}')">
                        <img src="${chan.logo}" class="channel-circle-img shadow-lg">
                        <p class="mt-2 text-[10px] font-black uppercase text-slate-800 truncate px-1">${name}</p>
                    </div>`;
                }).join('');
            }
        });

        function closePopup() { document.getElementById('socialPopup').style.display = 'none'; sessionStorage.setItem('vairalPop', 'done'); }
        setTimeout(() => { if(!sessionStorage.getItem('vairalPop')) document.getElementById('socialPopup').style.display = 'flex'; }, 3000);

        let cur = 0;
        function startSlideShow(count) {
            if(count <= 1) return;
            clearInterval(window.bannerInterval);
            window.bannerInterval = setInterval(() => {
                cur = (cur + 1) % count;
                const el = document.getElementById('slider');
                if(el) el.style.transform = `translateX(-${cur * 100}%)`;
            }, 4000);
        }

        function searchProduct() { 
            let v = document.getElementById('searchInput').value.toLowerCase(); 
            document.querySelectorAll('.video-card, .channel-circle-card').forEach(el => el.style.display = el.innerText.toLowerCase().includes(v) ? 'block' : 'none'); 
        }
    </script>
</body>
  </html>
